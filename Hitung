<h4>Bayar : 
    <input class="form-control" type="number" name="bayar" id="bayar">
</h4>
<h4 id="kembalianText">Kembalian :</h4>

<script>
    document.getElementById('bayar').addEventListener('input', function() {
        var bayar = parseInt(this.value);
        var total = <?php echo $totalharga; ?>;
        var kembali = bayar - total;
        
        // Menyaring nilai kembalian agar tidak negatif
        if (kembali < 0) {
            kembali = 0; // Set kembali ke 0 jika hasilnya negatif
        }
        
        // Simpan kembali ke dalam $_SESSION
        <?php echo "var sessionKembali = " . $_SESSION['kembali'] . ";" ?>
        if (sessionKembali !== undefined) {
            kembali = Math.max(kembali, sessionKembali); // Pastikan kembali tidak kurang dari nilai sebelumnya
        }
        <?php echo "$_SESSION['kembali'] = " ?> kembali;

        document.getElementById('kembalianText').innerText = 'Kembalian : Rp. ' + formatRupiah(kembali);
    });

    function formatRupiah(angka) {
        var number_string = angka.toString().replace(/[^,\d]/g, '');
        var split = number_string.split(',');
        var sisa = split[0].length % 3;
        var rupiah = split[0].substr(0, sisa);
        var ribuan = split[0].substr(sisa).match(/\d{1,3}/gi);

        if (ribuan) {
            separator = sisa ? '.' : '';
            rupiah += separator + ribuan.join('.');
        }

        rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
        return rupiah;
    }
</script>
